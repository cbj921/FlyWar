{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\enemyPrefab/assets\\Script\\enemyPrefab\\spacePlane.js"],"names":["cc","Class","extends","Component","properties","startBulletAttack","startImpactAttack","startHealth","startBulletSpeed","bulletFre","moveVenticalDuration","moveVenticalDistance","healthBar","ProgressBar","bulletPrefab","Prefab","initData","spacePlaneObject","JSON","parse","sys","localStorage","getItem","bulletAttack","impactAttack","health","bulletSpeed","coin","setItem","stringify","mainPlaneData","coinData","moveAction","randomPosition","moveTo","v2","node","x","backAction","callFunc","runAction","sequence","max","min","posY","posX","Math","floor","random","setPosition","initHealthBar","varHealth","progress","updateHealthBar","ratio","parent","getCoin","destroy","bulletInit","bulletPool","NodePool","bulletArray","initCount","i","bullet","instantiate","put","creatBullet","bulletCallback","size","get","position","y","bulletAction","schedule","bulletNode","duration","finished","shootAction","onCollisionEnter","other","self","tag","mainWeapon","attackNumber","subWeapon","laserGun","grainGun","onLoad","update","dt"],"mappings":"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","file":"spacePlane.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\enemyPrefab","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        startBulletAttack: 0, // 子弹攻击力\n        startImpactAttack: 0, // 撞击攻击力\n        startHealth: 0,  // 初始血量\n        startBulletSpeed: 0, // 初始子弹速度\n        bulletFre: 0, // 子弹频率\n\n        moveVenticalDuration: 0,\n        moveVenticalDistance: 0,\n\n        healthBar: cc.ProgressBar,\n        bulletPrefab:cc.Prefab,\n    },\n\n    initData() {\n        this.spacePlaneObject = JSON.parse(cc.sys.localStorage.getItem(\"spacePlaneObject\")); // 获取全局对象\n        if (this.spacePlaneObject == null) {\n            this.spacePlaneObject = {\n                bulletAttack: this.startBulletAttack, // 子弹攻击力\n                impactAttack: this.startImpactAttack, // 撞击攻击力\n                health: this.startHealth,  // 初始血量\n                bulletSpeed: this.startBulletSpeed, // 初始子弹速度\n                bulletFre: this.bulletFre, // 子弹频率\n                coin:700,\n            };\n            cc.sys.localStorage.setItem(\"spacePlaneObject\", JSON.stringify(this.spacePlaneObject));\n            this.spacePlaneObject = JSON.parse(cc.sys.localStorage.getItem(\"spacePlaneObject\")); // 获取全局对象\n        } // 初始化数据\n\n        this.mainPlaneData = JSON.parse(cc.sys.localStorage.getItem(\"mainPlaneObject\"));// 获取飞机数据\n        this.coinData = cc.sys.localStorage.getItem('coinData');// 得到金币数据\n    },\n\n    moveAction() {\n        this.randomPosition(380, -400); // 不要问我为什么是这个数值，我测试出来的\n\n        let moveAction = cc.moveTo(this.moveVenticalDuration, cc.v2(this.node.x, this.moveVenticalDistance));  // 移动到（0，-1100）的位置\n\n        this.backAction = cc.callFunc(()=>{\n            // 到底部回到顶部回调函数\n            this.randomPosition(380, -400); \n            moveAction = cc.moveTo(this.moveVenticalDuration, cc.v2(this.node.x, this.moveVenticalDistance));  // 重新设置 x 值\n            this.node.runAction(cc.sequence(moveAction,this.backAction));\n        });\n\n        this.node.runAction(cc.sequence(moveAction,this.backAction));\n    },\n    \n    randomPosition(max, min) {\n        //随机出现位置\n        let posY = 1020; // 起始纵坐标固定\n        let posX = Math.floor(Math.random() * (max - min)) + min; // \n        this.node.setPosition(posX, posY);\n    },\n\n    initHealthBar(){\n        // 更新血条，让血回满\n        // 初始化血量\n        this.varHealth=this.spacePlaneObject.health;\n        this.healthBar.progress = 1;\n    },\n\n    updateHealthBar(){\n        let ratio = this.varHealth/this.spacePlaneObject.health;\n        this.healthBar.progress = ratio;\n        if(ratio == 0){\n            this.node.parent = null;\n            this.getCoin();\n            this.node.destroy();\n        }\n    },\n    getCoin(){\n        // 击杀后得到金币\n        this.coinData = this.coinData-0 + this.spacePlaneObject.coin;\n        cc.sys.localStorage.setItem('coinData',this.coinData); \n    },\n\n    //子弹\n    bulletInit(bulletPrefab){\n        this.bulletPool = new cc.NodePool();\n        this.bulletArray = [];\n        let initCount = 10;\n        for(let i=0;i<initCount;i++){\n            let bullet = cc.instantiate(bulletPrefab);\n            this.bulletPool.put(bullet);\n        }\n    },\n\n    creatBullet(){\n        this.bulletCallback = ()=>{\n            // 计时器回调函数\n            let bullet = null;\n            if (this.bulletPool.size() > 0) { // 通过 size 接口判断对象池中是否有空闲的对象\n                bullet = this.bulletPool.get();\n            } else { // 如果没有空闲对象，也就是对象池中备用对象不够时，我们就用 cc.instantiate 重新创建\n                bullet = cc.instantiate(this.bulletPrefab);\n            }\n            bullet.parent = this.node.parent; // 将生成的子弹加入canvas节点\n            bullet.position = cc.v2(this.node.x,this.node.y);\n            this.bulletAction(bullet);\n        };\n\n        this.schedule(this.bulletCallback,this.spacePlaneObject.bulletFre);//\n        \n    },\n\n    bulletAction(bulletNode){\n        let duration = (this.node.y+1100)/(this.spacePlaneObject.bulletSpeed*100);  // 计算时间，这样不管在哪个位置发射子弹速度都一样了\n        this.moveAction = cc.moveTo(duration,cc.v2(this.node.x,-1100)); // 初始位置是0\n        this.finished = cc.callFunc(()=>{\n            if(this.bulletPool == null){ // 因为飞船没了后，对象池也没了\n                bulletNode.destroy();\n            }else{\n                this.bulletPool.put(bulletNode);\n            }\n        });\n        let shootAction = cc.sequence(this.moveAction,this.finished);\n        bulletNode.runAction(shootAction);\n    },\n\n     /**\n    * 当碰撞产生的时候调用\n    * @param  {Collider} other 产生碰撞的另一个碰撞组件\n    * @param  {Collider} self  产生碰撞的自身的碰撞组件\n    */\n   onCollisionEnter(other, self) {\n    // 敌机的碰撞tag暂时为，飞机：0，普通子弹：1\n    if(other.tag == 0){\n        this.node.destroy();\n    }\n    if(other.tag == 1){\n        //被子弹射中\n        this.varHealth -= this.mainPlaneData.mainWeapon.attackNumber;\n        if(this.varHealth<0){\n            this.varHealth =0;\n        }\n    }\n    if(other.tag == 2){\n        // 被镭射激光射中\n        this.varHealth -= this.mainPlaneData.subWeapon.laserGun.attackNumber;\n        if(this.varHealth<0){\n            this.varHealth =0;\n        }\n    }\n    if(other.tag == 3){\n        // 被粒子枪粒子击中\n        this.varHealth -= this.mainPlaneData.subWeapon.grainGun.attackNumber;\n        if(this.varHealth<0){\n            this.varHealth =0;\n        }\n    }\n},\n\n    onLoad () {\n        this.initData();\n        this.initHealthBar();\n        this.moveAction();\n        this.bulletInit(this.bulletPrefab);\n        this.creatBullet();\n    },\n\n    update (dt) {\n        this.updateHealthBar();\n    },\n});\n"]}