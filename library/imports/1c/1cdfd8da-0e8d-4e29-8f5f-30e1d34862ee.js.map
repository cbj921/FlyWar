{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\enemyPrefab/assets\\Script\\enemyPrefab\\UFO.js"],"names":["cc","Class","extends","Component","properties","startBulletAttack","startImpactAttack","startHealth","startBulletSpeed","bulletFre","moveHorizontalDuration","moveVenticalDuration","moveHorizontalDistance","moveVenticalDistance","healthBar","ProgressBar","bulletPrefab","Prefab","initData","UFOObject","JSON","parse","sys","localStorage","getItem","bulletAttack","impactAttack","health","bulletSpeed","coin","setItem","stringify","mainPlaneData","coinData","moveAction","randomPosition","moveRight","moveBy","v2","easing","easeCubicActionOut","moveLeft","moveHorizontal","repeat","sequence","moveVentical","moveTo","node","x","spawn","backAction","callFunc","runAction","max","min","posY","posX","Math","floor","random","setPosition","initHealthBar","varHealth","progress","updateHealthBar","ratio","parent","getCoin","destroy","bulletInit","bulletPool","NodePool","bulletArray","initCount","i","bullet","instantiate","put","creatBullet","bulletCallback","size","get","position","y","bulletAction","schedule","bulletNode","duration","finished","shootAction","onCollisionEnter","other","self","tag","mainWeapon","attackNumber","subWeapon","laserGun","grainGun","onLoad","start","update","dt"],"mappings":"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","file":"UFO.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\enemyPrefab","sourcesContent":["\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        startBulletAttack: 0, // 子弹攻击力\n        startImpactAttack: 0, // 撞击攻击力\n        startHealth: 0,  // 初始血量\n        startBulletSpeed: 0, // 初始子弹速度\n        bulletFre: 0, // 子弹频率\n\n        moveHorizontalDuration: 0,\n        moveVenticalDuration: 0,\n\n        moveHorizontalDistance: 0,\n        moveVenticalDistance: 0,\n\n        healthBar: cc.ProgressBar,\n        bulletPrefab:cc.Prefab,\n\n    },\n\n\n    initData() {\n        this.UFOObject = JSON.parse(cc.sys.localStorage.getItem(\"UFOObject\")); // 获取全局对象\n        if (this.UFOObject == null) {\n            this.UFOObject = {\n                bulletAttack: this.startBulletAttack, // 子弹攻击力\n                impactAttack: this.startImpactAttack, // 撞击攻击力\n                health: this.startHealth,  // 初始血量\n                bulletSpeed: this.startBulletSpeed, // 初始子弹速度\n                bulletFre: this.bulletFre, // 子弹频率\n                coin:100,\n            };\n            cc.sys.localStorage.setItem(\"UFOObject\", JSON.stringify(this.UFOObject));\n            this.UFOObject = JSON.parse(cc.sys.localStorage.getItem(\"UFOObject\")); // 获取全局对象\n        } // 初始化数据\n\n        this.mainPlaneData = JSON.parse(cc.sys.localStorage.getItem(\"mainPlaneObject\"));// 获取飞机数据\n        this.coinData = cc.sys.localStorage.getItem('coinData');// 得到金币数据\n    },\n\n    moveAction() {\n        this.randomPosition(380, -400); // 不要问我为什么是这个数值，我测试出来的\n\n        let moveRight = cc.moveBy(this.moveHorizontalDuration, cc.v2(this.moveHorizontalDistance, 0)).easing(cc.easeCubicActionOut());\n        let moveLeft = cc.moveBy(this.moveHorizontalDuration, cc.v2(-this.moveHorizontalDistance, 0)).easing(cc.easeCubicActionOut());\n\n        let moveHorizontal = cc.repeat(cc.sequence(moveRight, moveLeft), 5); // 左右横移\n        let moveVentical = cc.moveTo(this.moveVenticalDuration, cc.v2(this.node.x, this.moveVenticalDistance));  // 移动到（0，-1100）的位置\n\n        let moveAction = cc.spawn(moveHorizontal, moveVentical);\n\n        this.backAction = cc.callFunc(()=>{\n            // 到底部回到顶部回调函数\n            this.randomPosition(380, -400); \n            moveVentical = cc.moveTo(this.moveVenticalDuration, cc.v2(this.node.x, this.moveVenticalDistance));  // 重新设置 x 值\n            moveAction = cc.spawn(moveHorizontal, moveVentical);\n            this.node.runAction(cc.sequence(moveAction,this.backAction));\n        });\n\n        this.node.runAction(cc.sequence(moveAction,this.backAction));\n        //this.runAndBackAction(moveAction); //bug\n    },\n    \n    randomPosition(max, min) {\n        //随机出现位置\n        let posY = 1020; // 起始纵坐标固定\n        let posX = Math.floor(Math.random() * (max - min)) + min; // \n        this.node.setPosition(posX, posY);\n    },\n\n    initHealthBar(){\n        // 更新血条，让血回满\n        // 初始化血量\n        this.varHealth=this.UFOObject.health;\n        this.healthBar.progress = 1;\n    },\n\n    updateHealthBar(){\n        let ratio = this.varHealth/this.UFOObject.health;\n        this.healthBar.progress = ratio;\n        if(ratio == 0){\n            this.node.parent = null;\n            this.getCoin();\n            this.node.destroy();\n        }\n    },\n    getCoin(){\n        // 击杀后得到金币\n        this.coinData = this.coinData-0 + this.UFOObject.coin;\n        cc.sys.localStorage.setItem('coinData',this.coinData); \n    },\n\n    //子弹\n    bulletInit(bulletPrefab){\n        this.bulletPool = new cc.NodePool();\n        this.bulletArray = [];\n        let initCount = 10;\n        for(let i=0;i<initCount;i++){\n            let bullet = cc.instantiate(bulletPrefab);\n            this.bulletPool.put(bullet);\n        }\n    },\n\n    creatBullet(){\n        this.bulletCallback = ()=>{\n            // 计时器回调函数\n            let bullet = null;\n            if (this.bulletPool.size() > 0) { // 通过 size 接口判断对象池中是否有空闲的对象\n                bullet = this.bulletPool.get();\n            } else { // 如果没有空闲对象，也就是对象池中备用对象不够时，我们就用 cc.instantiate 重新创建\n                bullet = cc.instantiate(this.bulletPrefab);\n            }\n            bullet.parent = this.node.parent; // 将生成的子弹加入canvas节点\n            bullet.position = cc.v2(this.node.x,this.node.y);\n            this.bulletAction(bullet);\n        };\n\n        this.schedule(this.bulletCallback,this.UFOObject.bulletFre);//\n        \n    },\n\n    bulletAction(bulletNode){\n        let duration = (this.node.y+1100)/(this.UFOObject.bulletSpeed*100);  // 计算时间，这样不管在哪个位置发射子弹速度都一样了\n        this.moveAction = cc.moveTo(duration,cc.v2(this.node.x,-1100)); // 初始位置是0\n        this.finished = cc.callFunc(()=>{\n            if(this.bulletPool == null){ // 因为飞船没了后，对象池也没了\n                bulletNode.destroy();\n            }else{\n                this.bulletPool.put(bulletNode);\n            }\n        });\n        let shootAction = cc.sequence(this.moveAction,this.finished);\n        bulletNode.runAction(shootAction);\n    },\n    /**\n    * 当碰撞产生的时候调用\n    * @param  {Collider} other 产生碰撞的另一个碰撞组件\n    * @param  {Collider} self  产生碰撞的自身的碰撞组件\n    */\n    onCollisionEnter(other, self) {\n        // 敌机的碰撞tag暂时为，飞机：0，普通子弹：1\n        if(other.tag == 0){\n            this.node.destroy();\n        }\n        if(other.tag == 1){\n            //被子弹射中\n            this.varHealth -= this.mainPlaneData.mainWeapon.attackNumber;\n            if(this.varHealth<0){\n                this.varHealth =0;\n            }\n        }\n        if(other.tag == 2){\n            // 被镭射激光射中\n            this.varHealth -= this.mainPlaneData.subWeapon.laserGun.attackNumber;\n            if(this.varHealth<0){\n                this.varHealth =0;\n            }\n        }\n        if(other.tag == 3){\n            // 被粒子枪粒子击中\n            this.varHealth -= this.mainPlaneData.subWeapon.grainGun.attackNumber;\n            if(this.varHealth<0){\n                this.varHealth =0;\n            }\n        }\n    },\n\n\n    onLoad() {\n        this.initData();\n        this.initHealthBar();\n        this.moveAction();\n        this.bulletInit(this.bulletPrefab);\n        this.creatBullet();\n    },\n\n    start() {\n\n    },\n\n    update(dt) {\n        this.updateHealthBar();\n    },\n});\n"]}