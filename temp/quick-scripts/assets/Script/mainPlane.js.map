{"version":3,"sources":["mainPlane.js"],"names":["cc","Class","extends","Component","properties","endPosY","moveSpeed","moveLimit","startHealth","startBulletSpeed","startAttack","startPower","healthBar","ProgressBar","bullet","Prefab","grainGunBullet","laserGunBullet","strengthLabel","Node","powerBar","init","node","setPosition","v2","Canvas","parent","initData","mainPlaneObject","JSON","parse","sys","localStorage","getItem","protect","level","number","cost","mainWeapon","attackNumber","speedNumber","attackLevel","speedLevel","attackCost","speedCost","power","subWeapon","grainGun","powerCost","laserGun","setItem","stringify","varHealth","powerNumber","startFly","flyAction","moveTo","easing","easeCubicActionOut","runAction","initHealthBar","initPowerBar","registerPlaneControlEvent","creatBullet","getAllEnemyData","isMoving","startTouchBack","event","touches","getTouches","touchLoc","getLocation","moveToPos","convertToNodeSpaceAR","moveTouchBack","endTouchBack","on","EventType","TOUCH_START","TOUCH_MOVE","TOUCH_END","updatePlanePos","dt","oldPos","position","direction","sub","normalize","distance","mag","add","mul","progress","updateHealthBar","ratio","failEvent","emit","unschedule","bulletCallback","updatePowerBar","useGrainGun","grainBulletInit","useLaserGun","laserBulletInit","grainPool","undefined","NodePool","initCount","i","instantiate","put","size","get","x","y","grainBulletAction","schedule","bulletNode","offset","duration","moveAction","finished","callFunc","destroy","shootAction","sequence","laserPool","UFOData","rocketData","waveRobotData","spacePlaneData","bulletInit","bulletPrefab","bulletPool","bulletAction","onCollisionEnter","other","self","tag","impactAttack","bulletAttack","update","onLoad"],"mappings":"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","file":"mainPlane.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["\n//每次升级才要存储新的数据，其余时候只要读取就好 \n\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        endPosY: 0,\n        moveSpeed: 0,\n        moveLimit: 0, //移动的临界点\n\n        startHealth: 0,\n        startBulletSpeed: 0,\n        startAttack: 0,\n        startPower: 0,\n        healthBar: cc.ProgressBar,\n        bullet: [cc.Prefab],\n        grainGunBullet:cc.Prefab,\n        laserGunBullet:cc.Prefab,\n        strengthLabel:cc.Node,\n        powerBar:cc.ProgressBar,\n\n        //enemyScript:require('enemyControl'),\n    },\n\n    init() {\n        this.node.setPosition(cc.v2(0, -1760));\n        this.Canvas = this.node.parent;\n    },\n\n    initData() {\n        this.mainPlaneObject = JSON.parse(cc.sys.localStorage.getItem(\"mainPlaneObject\")); // 获取全局对象\n        if (this.mainPlaneObject == null) {\n            this.mainPlaneObject = {\n                protect: {\n                    level: 1,\n                    number: this.startHealth,\n                    cost: 100,\n                },\n                mainWeapon: {\n                    attackNumber: this.startAttack,\n                    speedNumber: this.startBulletSpeed,\n                    attackLevel: 1,\n                    speedLevel: 1,\n                    attackCost: 100,\n                    speedCost: 100,\n                },\n                power: {\n                    level: 1,\n                    number: this.startPower,\n                    cost: 150,\n                },\n                subWeapon:{\n                    grainGun: {\n                        attackNumber: 2,\n                        speedNumber: 5,\n                        attackLevel: 1,\n                        attackCost: 100,\n                        powerCost:10,\n                    },\n                    laserGun: {\n                        attackNumber: 20,\n                        speedNumber: 1,\n                        attackLevel: 1,\n                        attackCost: 200,\n                        powerCost:20,\n                    },\n                },\n            };\n            cc.sys.localStorage.setItem(\"mainPlaneObject\", JSON.stringify(this.mainPlaneObject));\n            this.mainPlaneObject = JSON.parse(cc.sys.localStorage.getItem(\"mainPlaneObject\")); // 获取全局对象\n        } // 初始化数据\n        this.varHealth = this.mainPlaneObject.protect.number; // 因为血量在游戏的时候会一直变化，所以用一个中间值来在游戏中进行改变\n        this.powerNumber = this.mainPlaneObject.power.number; // 能量同理\n    },\n\n    startFly() {\n        // 飞到指定位置\n        let flyAction = cc.moveTo(1, cc.v2(0, this.endPosY)).easing(cc.easeCubicActionOut());\n        this.node.runAction(flyAction);\n        this.initHealthBar();\n        this.initPowerBar();//初始化能量条\n        this.registerPlaneControlEvent();\n        this.creatBullet();\n        this.getAllEnemyData(); // 获取所有敌人数据\n    },\n\n    registerPlaneControlEvent() {\n        this.isMoving = false; // 记录单机事件是否在移动\n\n        this.startTouchBack = (event) => {\n            // 回调函数\n            let touches = event.getTouches();\n            let touchLoc = touches[0].getLocation(); // 获取到第一个触摸点的坐标\n            this.isMoving = true; // 正在移动标志位\n            this.moveToPos = this.Canvas.convertToNodeSpaceAR(touchLoc);\n        }\n        this.moveTouchBack = (event) => {\n            let touches = event.getTouches();\n            let touchLoc = touches[0].getLocation();\n            this.moveToPos = this.Canvas.convertToNodeSpaceAR(touchLoc);\n        }\n        this.endTouchBack = (event) => {\n            this.isMoving = false;\n        }\n\n        this.Canvas.on(cc.Node.EventType.TOUCH_START, this.startTouchBack, this.node);\n        this.Canvas.on(cc.Node.EventType.TOUCH_MOVE, this.moveTouchBack, this.node);\n        this.Canvas.on(cc.Node.EventType.TOUCH_END, this.endTouchBack, this.node);\n    },\n\n    updatePlanePos(dt) {\n        if (!this.isMoving) {\n            return;\n        }\n        let oldPos = this.node.position;\n        let direction = this.moveToPos.sub(oldPos).normalize();// 获得移动方向\n        let distance = this.moveToPos.sub(oldPos).mag(); // 获得向量的长度\n        if (distance > this.moveLimit) {\n            this.node.setPosition(oldPos.add(direction.mul(this.moveSpeed * dt)));\n        }\n        // 偏移方向\n\n    },\n\n    initHealthBar() {\n        // 更新血条，让血回满\n        // 初始化血量\n        this.varHealth = this.mainPlaneObject.protect.number;\n        this.healthBar.progress = 1;\n    },\n    updateHealthBar() {\n        let ratio = this.varHealth / this.mainPlaneObject.protect.number;\n        this.healthBar.progress = ratio;\n        if (ratio == 0) {\n            this.failEvent();\n        }\n    },\n\n    failEvent() {\n        this.initHealthBar();// 让血回满，就不会一直发射事件\n        this.strengthLabel.emit('fail');// 给strengthLabel发送失败事件\n        this.Canvas.emit(\"fail\"); // 给canvas 发送失败事件\n        this.unschedule(this.bulletCallback);// 关闭子弹发射\n    },\n\n    initPowerBar(){\n        this.powerNumber = this.mainPlaneObject.power.number; \n        this.powerBar.progress = 1;\n    },\n    updatePowerBar(){\n        // 更新能量条\n        let ratio = this.powerNumber / this.mainPlaneObject.power.number;\n        this.powerBar.progress = ratio;\n    },\n    // 副武器按键函数\n    useGrainGun(){\n        if(this.powerNumber>=this.mainPlaneObject.subWeapon.grainGun.powerCost){\n            this.powerNumber -= this.mainPlaneObject.subWeapon.grainGun.powerCost;\n            this.grainBulletInit();\n        }\n    },\n    useLaserGun(){\n        if(this.powerNumber>=this.mainPlaneObject.subWeapon.laserGun.powerCost){\n            this.powerNumber -= this.mainPlaneObject.subWeapon.laserGun.powerCost;\n            this.laserBulletInit();\n        }\n    },\n    grainBulletInit(){\n        if(this.grainPool == undefined){\n            // 对象池不存在我们才新建\n            this.grainPool = new cc.NodePool();\n            let initCount = 20;\n            for (let i = 0; i < initCount; i++) {\n                let bullet = cc.instantiate(this.grainGunBullet);\n                this.grainPool.put(bullet);\n            }\n        }\n        //\n        let bulletCallback = () => {\n            let bullet = null;\n            if (this.grainPool.size() > 0) { // 通过 size 接口判断对象池中是否有空闲的对象\n                bullet = this.grainPool.get();\n            } else { // 如果没有空闲对象，也就是对象池中备用对象不够时，我们就用 cc.instantiate 重新创建\n                bullet = cc.instantiate(this.grainGunBullet);\n            }\n            bullet.parent = this.node.parent; // 将生成的子弹加入canvas节点\n            bullet.position = cc.v2(this.node.x + 125, this.node.y); // 放在飞机右边\n            this.grainBulletAction(bullet,125);\n        };\n        this.schedule(bulletCallback,1 / (this.mainPlaneObject.subWeapon.grainGun.speedNumber),10);\n\n    },\n    grainBulletAction(bulletNode,offset) {\n        let duration = (1100 - this.node.y) / 2000;  // 计算时间，这样不管在哪个位置发射子弹速度都一样了\n        this.moveAction = cc.moveTo(duration, cc.v2(this.node.x+offset, 1100)); // 初始位置是0\n        this.finished = cc.callFunc(() => {\n            if (this.grainPool == null) {\n                bulletNode.destroy();  //因为飞机没了后，对象池也没了,所以把剩下的子弹销毁\n            } else {\n                this.grainPool.put(bulletNode);\n            }\n        });\n        let shootAction = cc.sequence(this.moveAction, this.finished);\n        bulletNode.runAction(shootAction);\n    },\n\n    laserBulletInit(){\n        this.laserPool = new cc.NodePool();\n        let initCount = 20;\n        for (let i = 0; i < initCount; i++) {\n            let bullet = cc.instantiate(this.grainGunBullet);\n            this.laserPool.put(bullet);\n        }\n    },\n///////////////////////\n    getAllEnemyData() {\n        // 获取到所有敌人数据\n        this.UFOData = JSON.parse(cc.sys.localStorage.getItem(\"UFOObject\"));\n        this.rocketData = JSON.parse(cc.sys.localStorage.getItem(\"rocketObject\"));\n        this.waveRobotData = JSON.parse(cc.sys.localStorage.getItem(\"waveRobotObject\"));\n        this.spacePlaneData = JSON.parse(cc.sys.localStorage.getItem(\"spacePlaneObject\"));\n        //获取到其他敌人\n        //。。。。\n\n        //cc.log(this.UFOData);\n    },\n\n    bulletInit(bulletPrefab) {\n        this.bulletPool = new cc.NodePool();\n        let initCount = 15;\n        for (let i = 0; i < initCount; i++) {\n            let bullet = cc.instantiate(bulletPrefab);\n            this.bulletPool.put(bullet);\n        }\n    },\n\n    creatBullet() {\n        this.bulletCallback = () => {\n            let bullet = null;\n            if (this.bulletPool.size() > 0) { // 通过 size 接口判断对象池中是否有空闲的对象\n                bullet = this.bulletPool.get();\n            } else { // 如果没有空闲对象，也就是对象池中备用对象不够时，我们就用 cc.instantiate 重新创建\n                bullet = cc.instantiate(this.bullet[0]);\n            }\n            bullet.parent = this.node.parent; // 将生成的子弹加入canvas节点\n            bullet.position = cc.v2(this.node.x, this.node.y);\n            this.bulletAction(bullet);\n        };\n        this.schedule(this.bulletCallback, 1 / (this.mainPlaneObject.mainWeapon.speedNumber / 10));//\n\n    },\n\n    bulletAction(bulletNode) {\n        let duration = (1100 - this.node.y) / 1200;  // 计算时间，这样不管在哪个位置发射子弹速度都一样了\n        this.moveAction = cc.moveTo(duration, cc.v2(this.node.x, 1100)); // 初始位置是0\n        this.finished = cc.callFunc(() => {\n            if (this.bulletPool == null) {\n                bulletNode.destroy();  //因为飞机没了后，对象池也没了,所以把剩下的子弹销毁\n            } else {\n                this.bulletPool.put(bulletNode);\n            }\n        });\n        let shootAction = cc.sequence(this.moveAction, this.finished);\n        bulletNode.runAction(shootAction);\n    },\n\n    /**\n* 当碰撞产生的时候调用\n* @param  {Collider} other 产生碰撞的另一个碰撞组件\n* @param  {Collider} self  产生碰撞的自身的碰撞组件\n*/\n    onCollisionEnter(other, self) {\n        if (other.tag == 0) {\n            //tag==0表示碰到飞碟\n            this.varHealth = this.varHealth - this.UFOData.impactAttack;\n            if (this.varHealth < 0) {\n                this.varHealth = 0;\n            }\n        }\n        if (other.tag == 1) {\n            //tag==1表示碰到飞碟子弹\n            this.varHealth = this.varHealth - this.UFOData.bulletAttack;\n            if (this.varHealth < 0) {\n                this.varHealth = 0;\n            }\n        }\n        if (other.tag == 2) {\n            //tag==2表示碰到火箭\n            this.varHealth = this.varHealth - this.rocketData.impactAttack;\n            if (this.varHealth < 0) {\n                this.varHealth = 0;\n            }\n        }\n        if (other.tag == 3) {\n            //tag==3表示碰到波动机器人\n            this.varHealth = this.varHealth - this.waveRobotData.impactAttack;\n            if (this.varHealth < 0) {\n                this.varHealth = 0;\n            }\n        }\n        if (other.tag == 4) {\n            //tag==4表示碰到波动机器人子弹\n            this.varHealth = this.varHealth - this.waveRobotData.bulletAttack;\n            if (this.varHealth < 0) {\n                this.varHealth = 0;\n            }\n        }\n        if (other.tag == 5) {\n            //tag==5表示碰到深空飞机\n            this.varHealth = this.varHealth - this.spacePlaneData.impactAttack;\n            if (this.varHealth < 0) {\n                this.varHealth = 0;\n            }\n        }\n        if (other.tag == 6) {\n            //tag==6表示碰到深空飞机子弹\n            this.varHealth = this.varHealth - this.spacePlaneData.bulletAttack;\n            if (this.varHealth < 0) {\n                this.varHealth = 0;\n            }\n        }\n\n\n    },\n\n    update(dt) {\n        this.updatePlanePos(dt);// 更新飞机位置\n        this.updateHealthBar();// 更新血条\n        this.updatePowerBar();// 更新能量条\n    },\n\n    onLoad() {\n        this.bulletInit(this.bullet[0]);\n    },\n\n\n});\n"]}