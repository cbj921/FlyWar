{"version":3,"sources":["throwRobot.js"],"names":["cc","Class","extends","Component","properties","startBulletAttack","startImpactAttack","startHealth","startBulletSpeed","bulletFre","moveHorizontalDuration","moveVenticalDuration","moveHorizontalDistance","moveVenticalDistance","healthBar","ProgressBar","bulletPrefab","Prefab","initData","throwRobotObject","JSON","parse","sys","localStorage","getItem","bulletAttack","impactAttack","health","bulletSpeed","coin","setItem","stringify","mainPlaneData","coinData","moveAction","randomPosition","moveRight","moveBy","v2","easing","easeCubicActionIn","moveLeft","easeCubicActionOut","moveHorizontal","repeat","sequence","moveVentical","moveTo","node","x","spawn","backAction","callFunc","runAction","max","min","posY","posX","Math","floor","random","setPosition","initHealthBar","varHealth","progress","updateHealthBar","ratio","parent","getCoin","destroy","bulletInit","bulletPool","NodePool","bulletArray","initCount","i","bullet","instantiate","put","creatBullet","bulletCallback","size","get","position","y","bulletAction","schedule","bulletNode","duration","finished","shootAction","onCollisionEnter","other","self","tag","mainWeapon","attackNumber","subWeapon","laserGun","grainGun","onLoad","update","dt"],"mappings":"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","file":"throwRobot.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\enemyPrefab","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        startBulletAttack: 0, // 子弹攻击力\r\n        startImpactAttack: 0, // 撞击攻击力\r\n        startHealth: 0,  // 初始血量\r\n        startBulletSpeed: 0, // 初始子弹速度\r\n        bulletFre: 0, // 子弹频率\r\n\r\n        moveHorizontalDuration: 0,\r\n        moveVenticalDuration: 0,\r\n\r\n        moveHorizontalDistance: 0,\r\n        moveVenticalDistance: 0,\r\n\r\n        healthBar: cc.ProgressBar,\r\n        bulletPrefab:cc.Prefab,\r\n    },\r\n    initData() {\r\n        this.throwRobotObject = JSON.parse(cc.sys.localStorage.getItem(\"throwRobotObject\")); // 获取全局对象\r\n        if (this.throwRobotObject == null) {\r\n            this.throwRobotObject = {\r\n                bulletAttack: this.startBulletAttack, // 子弹攻击力\r\n                impactAttack: this.startImpactAttack, // 撞击攻击力\r\n                health: this.startHealth,  // 初始血量\r\n                bulletSpeed: this.startBulletSpeed, // 初始子弹速度\r\n                bulletFre: this.bulletFre, // 子弹频率\r\n                coin:300,\r\n            };\r\n            cc.sys.localStorage.setItem(\"throwRobotObject\", JSON.stringify(this.throwRobotObject));\r\n            this.throwRobotObject = JSON.parse(cc.sys.localStorage.getItem(\"throwRobotObject\")); // 获取全局对象\r\n        } // 初始化数据\r\n\r\n        this.mainPlaneData = JSON.parse(cc.sys.localStorage.getItem(\"mainPlaneObject\"));// 获取飞机数据\r\n        this.coinData = cc.sys.localStorage.getItem('coinData');// 得到金币数据\r\n    },\r\n\r\n    moveAction() {\r\n        this.randomPosition(380, -400); // 不要问我为什么是这个数值，我测试出来的\r\n\r\n        let moveRight = cc.moveBy(this.moveHorizontalDuration, cc.v2(this.moveHorizontalDistance, 250)).easing(cc.easeCubicActionIn());\r\n        let moveLeft = cc.moveBy(this.moveHorizontalDuration, cc.v2(-this.moveHorizontalDistance, -250)).easing(cc.easeCubicActionOut());\r\n\r\n        let moveHorizontal = cc.repeat(cc.sequence(moveRight, moveLeft), 5); // 左右横跳\r\n        let moveVentical = cc.moveTo(this.moveVenticalDuration, cc.v2(this.node.x, this.moveVenticalDistance));  // 移动到（0，-1100）的位置\r\n\r\n        let moveAction = cc.spawn(moveHorizontal, moveVentical);\r\n\r\n        this.backAction = cc.callFunc(()=>{\r\n            // 到底部回到顶部回调函数\r\n            this.randomPosition(380, -400); \r\n            moveVentical = cc.moveTo(this.moveVenticalDuration, cc.v2(this.node.x, this.moveVenticalDistance));  // 重新设置 x 值\r\n            moveAction = cc.spawn(moveHorizontal, moveVentical);\r\n            this.node.runAction(cc.sequence(moveAction,this.backAction));\r\n        });\r\n\r\n        this.node.runAction(cc.sequence(moveAction,this.backAction));\r\n    },\r\n\r\n    randomPosition(max, min) {\r\n        //随机出现位置\r\n        let posY = 1020; // 起始纵坐标固定\r\n        let posX = Math.floor(Math.random() * (max - min)) + min; // \r\n        this.node.setPosition(posX, posY);\r\n    },\r\n\r\n    initHealthBar(){\r\n        // 更新血条，让血回满\r\n        // 初始化血量\r\n        this.varHealth=this.throwRobotObject.health;\r\n        this.healthBar.progress = 1;\r\n    },\r\n    updateHealthBar(){\r\n        let ratio = this.varHealth/this.throwRobotObject.health;\r\n        this.healthBar.progress = ratio;\r\n        if(ratio == 0){\r\n            this.node.parent = null;\r\n            this.getCoin();\r\n            this.node.destroy();\r\n        }\r\n    },\r\n\r\n    getCoin(){\r\n        // 击杀后得到金币\r\n        this.coinData = this.coinData-0 + this.throwRobotObject.coin;\r\n        cc.sys.localStorage.setItem('coinData',this.coinData); \r\n    },\r\n\r\n    //子弹\r\n    bulletInit(bulletPrefab){\r\n        this.bulletPool = new cc.NodePool();\r\n        this.bulletArray = [];\r\n        let initCount = 10;\r\n        for(let i=0;i<initCount;i++){\r\n            let bullet = cc.instantiate(bulletPrefab);\r\n            this.bulletPool.put(bullet);\r\n        }\r\n    },\r\n\r\n    creatBullet(){\r\n        this.bulletCallback = ()=>{\r\n            // 计时器回调函数\r\n            let bullet = null;\r\n            if (this.bulletPool.size() > 0) { // 通过 size 接口判断对象池中是否有空闲的对象\r\n                bullet = this.bulletPool.get();\r\n            } else { // 如果没有空闲对象，也就是对象池中备用对象不够时，我们就用 cc.instantiate 重新创建\r\n                bullet = cc.instantiate(this.bulletPrefab);\r\n            }\r\n            bullet.parent = this.node.parent; // 将生成的子弹加入canvas节点\r\n            bullet.position = cc.v2(this.node.x,this.node.y);\r\n            this.bulletAction(bullet);\r\n        };\r\n\r\n        this.schedule(this.bulletCallback,this.throwRobotObject.bulletFre);//\r\n        \r\n    },\r\n\r\n    bulletAction(bulletNode){\r\n        let duration = (this.node.y+1100)/(this.throwRobotObject.bulletSpeed*100);  // 计算时间，这样不管在哪个位置发射子弹速度都一样了\r\n        this.moveAction = cc.moveTo(duration,cc.v2(this.node.x,-1100)); // 初始位置是0\r\n        this.finished = cc.callFunc(()=>{\r\n            if(this.bulletPool == null){ // 因为飞船没了后，对象池也没了\r\n                bulletNode.destroy();\r\n            }else{\r\n                this.bulletPool.put(bulletNode);\r\n            }\r\n        });\r\n        let shootAction = cc.sequence(this.moveAction,this.finished);\r\n        bulletNode.runAction(shootAction);\r\n    },\r\n\r\n/**\r\n    * 当碰撞产生的时候调用\r\n    * @param  {Collider} other 产生碰撞的另一个碰撞组件\r\n    * @param  {Collider} self  产生碰撞的自身的碰撞组件\r\n    */\r\n   onCollisionEnter(other, self) {\r\n    // 敌机的碰撞tag暂时为，飞机：0，普通子弹：1\r\n    if(other.tag == 0){\r\n        this.node.destroy();\r\n    }\r\n    if(other.tag == 1){\r\n        //被子弹射中\r\n        this.varHealth -= this.mainPlaneData.mainWeapon.attackNumber;\r\n        if(this.varHealth<0){\r\n            this.varHealth =0;\r\n        }\r\n    }\r\n    if(other.tag == 2){\r\n        // 被镭射激光射中\r\n        this.varHealth -= this.mainPlaneData.subWeapon.laserGun.attackNumber;\r\n        if(this.varHealth<0){\r\n            this.varHealth =0;\r\n        }\r\n    }\r\n    if(other.tag == 3){\r\n        // 被粒子枪粒子击中\r\n        this.varHealth -= this.mainPlaneData.subWeapon.grainGun.attackNumber;\r\n        if(this.varHealth<0){\r\n            this.varHealth =0;\r\n        }\r\n    }\r\n},\r\n\r\n    onLoad () {\r\n        this.initData();\r\n        this.initHealthBar();\r\n        this.moveAction();\r\n        this.bulletInit(this.bulletPrefab);\r\n        this.creatBullet();\r\n    },\r\n    update(dt) {\r\n        this.updateHealthBar();\r\n    },\r\n\r\n});\r\n"]}