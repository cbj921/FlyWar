{"version":3,"sources":["enemyControl.js"],"names":["cc","Class","extends","Component","properties","UFOPrefab","Prefab","rocketPrefab","waveRobotPrefab","throwRobotPrefab","spacePlanePrefab","heavyWaterPlanePrefab","enemyNumberBar","ProgressBar","initLevelData","levelData","JSON","parse","sys","localStorage","getItem","init","makeDoneFlag","enemyArray","startGame","enemyNumber","makeEnemy","enemy","instantiate","parent","node","push","schedule","succeedEventEmit","map","item","active","removeByValue","length","emit","log","clearAllEnemy","unscheduleAllCallbacks","destroy","initEnemyData","UFOInitData","rocketInitData","waveRobotInitData","spacePlaneInitData","arr","val","i","splice","UFOObject","bulletAttack","impactAttack","health","bulletSpeed","bulletFre","coin","setItem","stringify","rocketObject","speed","waveRobotObject","spacePlaneObject","onLoad","progress","start","update","dt"],"mappings":"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","file":"enemyControl.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        UFOPrefab: cc.Prefab,\n        rocketPrefab: cc.Prefab,\n        waveRobotPrefab: cc.Prefab,\n        throwRobotPrefab: cc.Prefab,\n        spacePlanePrefab: cc.Prefab,\n        heavyWaterPlanePrefab: cc.Prefab,\n\n        enemyNumberBar:cc.ProgressBar,\n    },\n\n    initLevelData() {\n        let levelData = JSON.parse(cc.sys.localStorage.getItem(\"levelData\")); // 获取全局对象\n        return levelData;\n    },\n\n    init() {\n        this.levelData = this.initLevelData(); // 获得关卡数据\n        // 为什么makeDoneFlag 为 -1 ？？？\n        this.makeDoneFlag = -1; // 有点奇怪初始值为-1，这个变量为标志位，当它的值等于敌人的数量时，说明敌人的生成已经完成\n        this.enemyArray = [];\n    },\n\n    startGame() {\n        let enemyNumber = this.levelData.enemyNumber; // 获得敌人数量\n\n        this.makeEnemy = () => {\n            let enemy = cc.instantiate(this.UFOPrefab);\n            enemy.parent = this.node;\n            this.enemyArray.push(enemy);\n            this.makeDoneFlag +=1;\n        };\n        this.schedule(this.makeEnemy, 2, enemyNumber);\n    },\n\n    succeedEventEmit() {\n        this.enemyArray.map((item) => {\n            if (item.active == false) {\n                item.parent = null;\n                this.removeByValue(this.enemyArray, item);\n            }\n        });\n        if ((this.makeDoneFlag == this.levelData.enemyNumber) && (this.enemyArray.length == 0)) {\n            this.node.emit(\"succeed\");\n            this.makeDoneFlag = -1;\n            cc.log('succeed');\n        }\n    },\n\n    clearAllEnemy() {\n        // 停止所有计时器\n        // 将全局数组里面的敌人都销毁就好了\n        cc.log('clear');\n        this.unscheduleAllCallbacks();\n        cc.log(this.enemyArray);\n        this.enemyArray.map((item) => {\n            item.parent = null;\n            item.destroy(); //销毁数组中的节点\n        });\n        this.enemyArray = []; //清空数组\n        this.makeDoneFlag = -1; // 将标志位设回原样\n    },\n\n    initEnemyData() {\n        // 这里必须初始化一次，否则第一次进游戏会出错\n        this.UFOInitData();\n        this.rocketInitData();\n        this.waveRobotInitData();\n        this.spacePlaneInitData();\n    },\n\n    // 删除数组特定元素的方法\n    removeByValue(arr, val) {\n        for (let i = 0; i < arr.length; i++) {\n            if (arr[i] == val) {\n                arr.splice(i, 1);\n                break;\n            }\n        }\n    },\n\n\n\n    /*初始化数据*/\n    UFOInitData() {\n        this.UFOObject = JSON.parse(cc.sys.localStorage.getItem(\"UFOObject\")); // 获取全局对象\n        if (this.UFOObject == null) {\n            this.UFOObject = {\n                bulletAttack: 20, // 子弹攻击力\n                impactAttack: 40, // 撞击攻击力\n                health: 100,  // 初始血量\n                bulletSpeed: 10, // 初始子弹速度\n                bulletFre: 2.5, // 子弹频率\n                coin: 100,\n            };\n            cc.sys.localStorage.setItem(\"UFOObject\", JSON.stringify(this.UFOObject));\n        } // 初始化数据\n    },\n    rocketInitData() {\n        this.rocketObject = JSON.parse(cc.sys.localStorage.getItem(\"rocketObject\")); // 获取全局对象\n        if (this.rocketObject == null) {\n            this.rocketObject = {\n                impactAttack: 40, // 撞击攻击力\n                health: 50,  // 初始血量\n                speed: 5, // 初始速度\n                coin: 200,\n            };\n            cc.sys.localStorage.setItem(\"rocketObject\", JSON.stringify(this.rocketObject));\n        } // 初始化数据\n    },\n    waveRobotInitData() {\n        this.waveRobotObject = JSON.parse(cc.sys.localStorage.getItem(\"waveRobotObject\")); // 获取全局对象\n        if (this.waveRobotObject == null) {\n            this.waveRobotObject = {\n                bulletAttack: 50, // 子弹攻击力\n                impactAttack: 120, // 撞击攻击力\n                health: 250,  // 初始血量\n                bulletSpeed: 5, // 初始子弹速度\n                bulletFre: 4, // 子弹频率\n                coin: 300,\n            };\n            cc.sys.localStorage.setItem(\"waveRobotObject\", JSON.stringify(this.waveRobotObject));\n        } // 初始化数据\n    },\n    spacePlaneInitData() {\n        this.spacePlaneObject = JSON.parse(cc.sys.localStorage.getItem(\"spacePlaneObject\")); // 获取全局对象\n        if (this.spacePlaneObject == null) {\n            this.spacePlaneObject = {\n                bulletAttack: 200, // 子弹攻击力\n                impactAttack: 600, // 撞击攻击力\n                health: 800,  // 初始血量\n                bulletSpeed: 1, // 初始子弹速度\n                bulletFre: 4, // 子弹频率\n                coin: 700,\n            };\n            cc.sys.localStorage.setItem(\"spacePlaneObject\", JSON.stringify(this.spacePlaneObject));\n        } // 初始化数据\n    },\n    /**********************/\n\n    onLoad() {\n        this.enemyNumberBar.progress = -1;\n    },\n\n    start() {\n\n    },\n\n    update(dt) {\n        this.succeedEventEmit();\n        //cc.log('enemy:'+this.enemyArray.length);\n        //cc.log('flag:'+this.makeDoneFlag)\n    },\n});\n"]}