{"version":3,"sources":["enemyControl.js"],"names":["cc","Class","extends","Component","properties","UFOPrefab","Prefab","rocketPrefab","waveRobotPrefab","throwRobotPrefab","spacePlanePrefab","heavyWaterPlanePrefab","enemyNumberBar","ProgressBar","failButton","Node","initLevelData","levelData","JSON","parse","sys","localStorage","getItem","init","makeDoneFlag","enemyArray","active","startGame","enemyNumber","makeEnemy","enemy","instantiate","parent","node","push","schedule","creatEnemy","succeedEventEmit","map","item","removeByValue","length","emit","popFailButton","clearAllEnemy","unscheduleAllCallbacks","destroy","initEnemyData","UFOInitData","rocketInitData","waveRobotInitData","spacePlaneInitData","arr","val","i","splice","UFOObject","bulletAttack","impactAttack","health","bulletSpeed","bulletFre","coin","setItem","stringify","rocketObject","speed","waveRobotObject","spacePlaneObject","onLoad","progress","start","update","dt"],"mappings":"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","file":"enemyControl.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        UFOPrefab: cc.Prefab,\n        rocketPrefab: cc.Prefab,\n        waveRobotPrefab: cc.Prefab,\n        throwRobotPrefab: cc.Prefab,\n        spacePlanePrefab: cc.Prefab,\n        heavyWaterPlanePrefab: cc.Prefab,\n\n        enemyNumberBar:cc.ProgressBar,\n        failButton:cc.Node,\n    },\n\n    initLevelData() {\n        let levelData = JSON.parse(cc.sys.localStorage.getItem(\"levelData\")); // 获取全局对象\n        return levelData;\n    },\n\n    init() {\n        this.levelData = this.initLevelData(); // 获得关卡数据\n        // 为什么makeDoneFlag 为 -1 ？？？\n        this.makeDoneFlag = -1; // 有点奇怪初始值为-1，这个变量为标志位，当它的值等于敌人的数量时，说明敌人的生成已经完成\n        this.enemyArray = [];\n        this.failButton.active = false; // 初始让失败按钮不可见\n    },\n\n    startGame() {\n        let enemyNumber = this.levelData.enemyNumber; // 获得敌人数量\n\n        this.makeEnemy = () => {\n            let enemy = cc.instantiate(this.UFOPrefab);\n            enemy.parent = this.node;\n            this.enemyArray.push(enemy);\n            this.makeDoneFlag +=1;\n        };\n        this.schedule(this.makeEnemy, 2, enemyNumber);\n    },\n    creatEnemy(){\n        // 创建敌人\n        let enemyNumber = this.levelData.enemyNumber; // 获得敌人数量\n    },\n\n    succeedEventEmit() {\n        this.enemyArray.map((item) => {\n            if (item.active == false) {\n                item.parent = null;\n                this.removeByValue(this.enemyArray, item);\n            }\n        });\n        if ((this.makeDoneFlag == this.levelData.enemyNumber) && (this.enemyArray.length == 0)) {\n            this.node.emit(\"succeed\");\n            this.makeDoneFlag = -1;\n        }\n    },\n\n    popFailButton(){\n        //弹出失败重来按钮\n        this.failButton.active = true;\n    },\n\n    clearAllEnemy() {\n        // 停止所有计时器\n        // 将全局数组里面的敌人都销毁就好了\n        this.unscheduleAllCallbacks();\n        this.enemyArray.map((item) => {\n            item.parent = null;\n            item.destroy(); //销毁数组中的节点\n        });\n        this.enemyArray = []; //清空数组\n        this.makeDoneFlag = -1; // 将标志位设回原样\n    },\n\n    initEnemyData() {\n        // 这里必须初始化一次，否则第一次进游戏会出错\n        this.UFOInitData();\n        this.rocketInitData();\n        this.waveRobotInitData();\n        this.spacePlaneInitData();\n    },\n\n    // 删除数组特定元素的方法\n    removeByValue(arr, val) {\n        for (let i = 0; i < arr.length; i++) {\n            if (arr[i] == val) {\n                arr.splice(i, 1);\n                break;\n            }\n        }\n    },\n\n\n\n    /*初始化数据*/\n    UFOInitData() {\n        this.UFOObject = JSON.parse(cc.sys.localStorage.getItem(\"UFOObject\")); // 获取全局对象\n        if (this.UFOObject == null) {\n            this.UFOObject = {\n                bulletAttack: 20, // 子弹攻击力\n                impactAttack: 40, // 撞击攻击力\n                health: 100,  // 初始血量\n                bulletSpeed: 10, // 初始子弹速度\n                bulletFre: 2.5, // 子弹频率\n                coin: 100,\n            };\n            cc.sys.localStorage.setItem(\"UFOObject\", JSON.stringify(this.UFOObject));\n        } // 初始化数据\n    },\n    rocketInitData() {\n        this.rocketObject = JSON.parse(cc.sys.localStorage.getItem(\"rocketObject\")); // 获取全局对象\n        if (this.rocketObject == null) {\n            this.rocketObject = {\n                impactAttack: 40, // 撞击攻击力\n                health: 50,  // 初始血量\n                speed: 5, // 初始速度\n                coin: 200,\n            };\n            cc.sys.localStorage.setItem(\"rocketObject\", JSON.stringify(this.rocketObject));\n        } // 初始化数据\n    },\n    waveRobotInitData() {\n        this.waveRobotObject = JSON.parse(cc.sys.localStorage.getItem(\"waveRobotObject\")); // 获取全局对象\n        if (this.waveRobotObject == null) {\n            this.waveRobotObject = {\n                bulletAttack: 50, // 子弹攻击力\n                impactAttack: 120, // 撞击攻击力\n                health: 250,  // 初始血量\n                bulletSpeed: 5, // 初始子弹速度\n                bulletFre: 4, // 子弹频率\n                coin: 300,\n            };\n            cc.sys.localStorage.setItem(\"waveRobotObject\", JSON.stringify(this.waveRobotObject));\n        } // 初始化数据\n    },\n    spacePlaneInitData() {\n        this.spacePlaneObject = JSON.parse(cc.sys.localStorage.getItem(\"spacePlaneObject\")); // 获取全局对象\n        if (this.spacePlaneObject == null) {\n            this.spacePlaneObject = {\n                bulletAttack: 200, // 子弹攻击力\n                impactAttack: 600, // 撞击攻击力\n                health: 800,  // 初始血量\n                bulletSpeed: 1, // 初始子弹速度\n                bulletFre: 4, // 子弹频率\n                coin: 700,\n            };\n            cc.sys.localStorage.setItem(\"spacePlaneObject\", JSON.stringify(this.spacePlaneObject));\n        } // 初始化数据\n    },\n    /**********************/\n\n    onLoad() {\n        this.enemyNumberBar.progress = -1;\n    },\n\n    start() {\n\n    },\n\n    update(dt) {\n        this.succeedEventEmit();\n        //cc.log('enemy:'+this.enemyArray.length);\n        //cc.log('flag:'+this.makeDoneFlag)\n    },\n});\n"]}